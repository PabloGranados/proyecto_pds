<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindfulness Visual - Cuida Tu Mente</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* === ESTILO BASE CUIDA TU MENTE === */
        
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #f8f3ff 0%, #fff5f8 50%, #f0f8ff 100%);
            color: #4a4a4a;
            min-height: 100vh;
        }

        /* Formas flotantes animadas */
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            animation: float 20s infinite ease-in-out;
        }

        .shape:nth-child(1) {
            width: 200px;
            height: 200px;
            background: #c7b8ea;
            top: 10%;
            left: 10%;
        }

        .shape:nth-child(2) {
            width: 150px;
            height: 150px;
            background: #ffb3d9;
            top: 60%;
            right: 15%;
            animation-delay: 5s;
        }

        .shape:nth-child(3) {
            width: 120px;
            height: 120px;
            background: #a8d8ea;
            top: 40%;
            left: 70%;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-40px) rotate(180deg); }
        }

        .content-wrapper {
            position: relative;
            z-index: 2;
        }

        /* Header */
        header {
            padding: 15px 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(199, 184, 234, 0.3);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .navbar-brand {
            font-size: 2rem;
            font-weight: bold;
            color: #8b7ab8 !important;
            text-shadow: 2px 2px 4px rgba(139, 122, 184, 0.2);
        }

        .navbar-nav .nav-link {
            color: #6b5b95 !important;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 10px 15px !important;
            border-radius: 20px;
            margin: 0 5px;
        }

        .navbar-nav .nav-link:hover {
            background: rgba(199, 184, 234, 0.2);
            transform: translateY(-2px);
        }

        /* === NAVEGACIÓN MEJORADA === */
        .navbar-nav .nav-link.active {
            background: linear-gradient(135deg, #c7b8ea 0%, #8b7ab8 100%);
            color: white !important;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(139, 122, 184, 0.4);
        }

        .dropdown-menu {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(199, 184, 234, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(139, 122, 184, 0.2);
            padding: 10px 5px;
        }

        .dropdown-item {
            color: #6b5b95;
            transition: all 0.3s ease;
            border-radius: 10px;
            margin: 2px 5px;
            padding: 8px 15px;
        }

        .dropdown-item:hover {
            background: rgba(199, 184, 234, 0.2);
            color: #8b7ab8;
            transform: translateX(5px);
        }

        .dropdown-item.active {
            background: linear-gradient(135deg, #c7b8ea 0%, #8b7ab8 100%);
            color: white;
        }

        .dropdown-item i {
            width: 20px;
            text-align: center;
            margin-right: 8px;
        }

        /* Títulos principales */
        .main-title {
            font-size: 3rem;
            color: #8b7ab8;
            text-align: center;
            margin-bottom: 20px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #6b5b95;
            text-align: center;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto 40px;
        }

        /* === ESTILOS DEL MINDFULNESS === */
        
        .mindfulness-container {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 20px 40px rgba(199, 184, 234, 0.2);
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Área de visualización principal */
        .visualization-area {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 30px auto;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(199, 184, 234, 0.1) 0%, rgba(255, 255, 255, 0.3) 100%);
            overflow: hidden;
        }

        /* Círculo de respiración central */
        .breathing-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            border: 4px solid #c7b8ea;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 3s ease;
            background: radial-gradient(circle, rgba(168, 216, 234, 0.2) 0%, rgba(199, 184, 234, 0.2) 100%);
        }

        .breathing-circle.inhale {
            transform: translate(-50%, -50%) scale(1.4);
            background: radial-gradient(circle, rgba(168, 216, 234, 0.4) 0%, rgba(199, 184, 234, 0.4) 100%);
            box-shadow: 0 0 40px rgba(199, 184, 234, 0.6);
        }

        .breathing-circle.exhale {
            transform: translate(-50%, -50%) scale(0.7);
            background: radial-gradient(circle, rgba(255, 179, 217, 0.4) 0%, rgba(199, 184, 234, 0.4) 100%);
            box-shadow: 0 0 20px rgba(255, 179, 217, 0.4);
        }

        /* Elementos mindful flotantes */
        .mindful-element {
            position: absolute;
            font-size: 2rem;
            color: rgba(139, 122, 184, 0.7);
            animation: mindfulFloat 6s infinite ease-in-out;
            transition: all 0.3s ease;
        }

        .mindful-element:nth-child(2) { top: 10%; left: 50%; animation-delay: 0s; }
        .mindful-element:nth-child(3) { top: 20%; left: 20%; animation-delay: 1s; }
        .mindful-element:nth-child(4) { top: 20%; right: 20%; animation-delay: 2s; }
        .mindful-element:nth-child(5) { bottom: 20%; left: 20%; animation-delay: 3s; }
        .mindful-element:nth-child(6) { bottom: 20%; right: 20%; animation-delay: 4s; }

        @keyframes mindfulFloat {
            0%, 100% { transform: translateY(0px); opacity: 0.7; }
            50% { transform: translateY(-20px); opacity: 1; }
        }

        /* Instrucciones de respiración */
        .breathing-instruction {
            font-size: 1.8rem;
            font-weight: bold;
            color: #8b7ab8;
            margin: 30px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
        }

        /* Controles del juego */
        .game-controls {
            margin: 30px 0;
        }

        .control-btn {
            background: linear-gradient(45deg, #c7b8ea, #ffb3d9);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(199, 184, 234, 0.4);
            cursor: pointer;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(199, 184, 234, 0.6);
        }

        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Contador de sesión */
        .session-stats {
            background: rgba(139, 122, 184, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin: 30px 0;
        }

        .stat-item {
            display: inline-block;
            margin: 0 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #8b7ab8;
            display: block;
        }

        .stat-label {
            color: #6b5b95;
            font-size: 0.9rem;
        }

        /* Mensajes motivacionales */
        .motivational-message {
            background: linear-gradient(135deg, #ffb3d9, #ffd3a5);
            color: white;
            padding: 20px;
            border-radius: 20px;
            margin: 20px 0;
            font-size: 1.1rem;
            font-style: italic;
            box-shadow: 0 10px 25px rgba(255, 179, 217, 0.3);
        }

        /* Animaciones */
        .fade-in {
            animation: fadeIn 1s ease-in;
        }

        .fade-in-delay-1 { animation: fadeIn 1s ease-in 0.2s both; }
        .fade-in-delay-2 { animation: fadeIn 1s ease-in 0.4s both; }
        .fade-in-delay-3 { animation: fadeIn 1s ease-in 0.6s both; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
            }
            
            .visualization-area {
                width: 300px;
                height: 300px;
            }
            
            .breathing-circle {
                width: 150px;
                height: 150px;
            }
            
            .mindfulness-container {
                padding: 25px;
                margin: 20px 10px;
            }
            
            .stat-item {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="content-wrapper">
        <!-- Header -->
        <header>
            <nav class="navbar navbar-expand-lg">
                <div class="container">
                    <a class="navbar-brand" href="index.html">
                        <i class="fas fa-heart"></i> Cuida Tu Mente
                    </a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="index.html">
                                    <i class="fas fa-home"></i> Inicio
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.html#que-es">¿Qué es?</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.html#autocuidado">Autocuidado</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="test.html">
                                    <i class="fas fa-clipboard-check"></i> Test
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle active" href="#" id="herramientasDropdown" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-tools"></i> Herramientas
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="juegos.html">
                                        <i class="fas fa-gamepad"></i> Juegos Terapéuticos
                                    </a></li>
                                    <li><a class="dropdown-item" href="gratitud.html">
                                        <i class="fas fa-feather-alt"></i> Diario de Gratitud
                                    </a></li>
                                    <li><a class="dropdown-item" href="respiracion.html">
                                        <i class="fas fa-lungs"></i> Respiración Guiada
                                    </a></li>
                                    <li><a class="dropdown-item active" href="mindfulness.html">
                                        <i class="fas fa-eye"></i> Mindfulness Visual
                                    </a></li>
                                    <li><a class="dropdown-item" href="afirmaciones.html">
                                        <i class="fas fa-star"></i> Afirmaciones Positivas
                                    </a></li>
                                    <li><a class="dropdown-item" href="altruista.html">
                                        <i class="fas fa-hands-helping"></i> Actividades Altruistas
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="mental-health-chat-app/public/chat.html">
                                        <i class="fas fa-comments"></i> Chat de Apoyo
                                    </a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.html#recursos">
                                    <i class="fas fa-phone-alt"></i> Recursos
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>

        <!-- Contenido principal -->
        <main class="container py-5">
            <h1 class="main-title fade-in">
                <i class="fas fa-eye"></i>
                Mindfulness Visual
            </h1>
            <p class="subtitle fade-in">
                Encuentra tu centro a través de la visualización consciente. 
                Permite que tu mente se aquiete mientras observas y respiras en armonía.
            </p>

            <div class="mindfulness-container fade-in-delay-1">
                <!-- Área de visualización principal -->
                <div class="visualization-area" id="visualizationArea">
                    <div class="breathing-circle" id="breathingCircle"></div>
                    <div class="mindful-element"><i class="fas fa-leaf"></i></div>
                    <div class="mindful-element"><i class="fas fa-cloud"></i></div>
                    <div class="mindful-element"><i class="fas fa-star"></i></div>
                    <div class="mindful-element"><i class="fas fa-heart"></i></div>
                    <div class="mindful-element"><i class="fas fa-sun"></i></div>
                </div>

                <!-- Instrucciones de respiración -->
                <div class="breathing-instruction" id="breathingInstruction">
                    Presiona "Comenzar" para iniciar tu sesión de mindfulness
                </div>

                <!-- Controles del juego -->
                <div class="game-controls">
                    <button class="control-btn" id="startBtn">
                        <i class="fas fa-play"></i> Comenzar
                    </button>
                    <button class="control-btn" id="pauseBtn" disabled>
                        <i class="fas fa-pause"></i> Pausar
                    </button>
                    <button class="control-btn" id="resetBtn">
                        <i class="fas fa-redo"></i> Reiniciar
                    </button>
                </div>

                <!-- Estadísticas de la sesión -->
                <div class="session-stats fade-in-delay-2">
                    <div class="stat-item">
                        <span class="stat-number" id="breathCount">0</span>
                        <span class="stat-label">Respiraciones</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="sessionTime">00:00</span>
                        <span class="stat-label">Tiempo de sesión</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="mindfulScore">0</span>
                        <span class="stat-label">Puntos de calma</span>
                    </div>
                </div>

                <!-- Mensaje motivacional -->
                <div class="motivational-message fade-in-delay-3" id="motivationalMessage">
                    <i class="fas fa-quote-left"></i> Bienvenido a tu espacio de calma interior <i class="fas fa-quote-right"></i>
                </div>

                <!-- Sección de Herramientas Relacionadas -->
                <div class="container mt-5 mb-4">
                    <div class="row">
                        <div class="col-12">
                            <div style="background: rgba(255, 255, 255, 0.9); border-radius: 25px; padding: 40px; box-shadow: 0 15px 35px rgba(199, 184, 234, 0.15);">
                                <h3 style="color: #8b7ab8; text-align: center; margin-bottom: 30px;">
                                    <i class="fas fa-tools"></i> Otras herramientas que pueden ayudarte
                                </h3>
                                <div class="row g-3">
                                    <div class="col-md-4 text-center">
                                        <a href="respiracion.html" class="text-decoration-none">
                                            <div style="background: linear-gradient(135deg, #c7b8ea, #a8d8ea); border-radius: 15px; padding: 20px; color: white; transition: all 0.3s ease;" 
                                                 onmouseover="this.style.transform='scale(1.05)'" 
                                                 onmouseout="this.style.transform='scale(1)'">
                                                <i class="fas fa-lungs fa-2x mb-2"></i>
                                                <h5>Respiración Guiada</h5>
                                                <p style="font-size: 0.9rem; margin: 0;">Ejercicios de respiración</p>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <a href="afirmaciones.html" class="text-decoration-none">
                                            <div style="background: linear-gradient(135deg, #ffb3d9, #ffd3a5); border-radius: 15px; padding: 20px; color: white; transition: all 0.3s ease;" 
                                                 onmouseover="this.style.transform='scale(1.05)'" 
                                                 onmouseout="this.style.transform='scale(1)'">
                                                <i class="fas fa-star fa-2x mb-2"></i>
                                                <h5>Afirmaciones Positivas</h5>
                                                <p style="font-size: 0.9rem; margin: 0;">Fortalece tu autoestima</p>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <a href="mental-health-chat-app/public/chat.html" class="text-decoration-none">
                                            <div style="background: linear-gradient(135deg, #a8d8ea, #c7b8ea); border-radius: 15px; padding: 20px; color: white; transition: all 0.3s ease;" 
                                                 onmouseover="this.style.transform='scale(1.05)'" 
                                                 onmouseout="this.style.transform='scale(1)'">
                                                <i class="fas fa-comments fa-2x mb-2"></i>
                                                <h5>Chat de Apoyo</h5>
                                                <p style="font-size: 0.9rem; margin: 0;">Habla con nuestra IA especializada</p>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                
                                <!-- Botón Volver al Inicio -->
                                <div class="text-center mt-4">
                                    <a href="index.html" style="background: linear-gradient(135deg, #8b7ab8, #c7b8ea); color: white; padding: 12px 30px; border-radius: 25px; text-decoration: none; display: inline-block; transition: all 0.3s ease; font-weight: 500;"
                                       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 25px rgba(139, 122, 184, 0.3)'"
                                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                        <i class="fas fa-home"></i> Volver al Inicio
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        console.log('🚀 Iniciando aplicación de mindfulness...');
        
        // Variables globales
        let isSessionActive = false;
        let breathCount = 0;
        let sessionTime = 0;
        let mindfulScore = 0;
        let currentPhase = 'prepare';
        let sessionTimer = null;
        let breathingTimer = null;
        
        // Configuración de tiempos (en milisegundos)
        const PREPARE_TIME = 1000;
        const INHALE_TIME = 4000;
        const HOLD_TIME = 2000;
        const EXHALE_TIME = 6000;
        
        // Elementos del DOM
        let startBtn, pauseBtn, resetBtn;
        let breathingInstruction, breathingCircle;
        let breathCountElement, sessionTimeElement, mindfulScoreElement;
        let motivationalMessageElement;
        
        // Mensajes motivacionales
        const motivationalMessages = [
            "Cada respiración te lleva a un estado más profundo de calma",
            "Tu mente es como el agua: cuando está agitada, es difícil ver; cuando está calmada, todo se ve claro",
            "El presente es el único momento que realmente tienes",
            "La meditación no se trata de detener los pensamientos, sino de observarlos sin juicio",
            "Cada momento mindful es un regalo que te das a ti mismo",
            "La paz viene de dentro. No la busques fuera",
            "Respira profundo y deja que tu alma se expanda",
            "En la quietud de tu mente encontrarás todas las respuestas",
            "El mindfulness es estar completamente despierto en tu vida",
            "Tu respiración es tu ancla al momento presente"
        ];
        
        // Función para inicializar elementos
        function initializeElements() {
            startBtn = document.getElementById('startBtn');
            pauseBtn = document.getElementById('pauseBtn');
            resetBtn = document.getElementById('resetBtn');
            breathingInstruction = document.getElementById('breathingInstruction');
            breathingCircle = document.getElementById('breathingCircle');
            breathCountElement = document.getElementById('breathCount');
            sessionTimeElement = document.getElementById('sessionTime');
            mindfulScoreElement = document.getElementById('mindfulScore');
            motivationalMessageElement = document.getElementById('motivationalMessage');
            
            console.log('Elementos encontrados:', {
                startBtn: !!startBtn,
                pauseBtn: !!pauseBtn,
                resetBtn: !!resetBtn,
                breathingInstruction: !!breathingInstruction,
                breathingCircle: !!breathingCircle
            });
        }
        
        // Función para iniciar mindfulness
        function startMindfulness() {
            console.log('🟢 Iniciando sesión de mindfulness...');
            
            if (isSessionActive) {
                console.log('⚠️ Sesión ya está activa');
                return;
            }
            
            isSessionActive = true;
            
            // Cambiar botones
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            
            // Iniciar timer de sesión
            startSessionTimer();
            
            // Comenzar primer ciclo de respiración
            startBreathingCycle();
        }
        
        // Función para pausar mindfulness
        function pauseMindfulness() {
            console.log('⏸️ Pausando sesión de mindfulness...');
            
            isSessionActive = false;
            clearTimeout(breathingTimer);
            clearInterval(sessionTimer);
            
            // Cambiar botones
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            // Resetear visual
            breathingCircle.className = 'breathing-circle';
            breathingInstruction.innerHTML = '<i class="fas fa-pause"></i> Sesión pausada. Presiona "Comenzar" para continuar';
            currentPhase = 'paused';
        }
        
        // Función para reiniciar mindfulness
        function resetMindfulness() {
            console.log('🔄 Reiniciando sesión de mindfulness...');
            
            // Parar todo
            isSessionActive = false;
            clearTimeout(breathingTimer);
            clearInterval(sessionTimer);
            
            // Resetear variables
            breathCount = 0;
            sessionTime = 0;
            mindfulScore = 0;
            currentPhase = 'prepare';
            
            // Resetear UI
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            breathingCircle.className = 'breathing-circle';
            breathingInstruction.textContent = 'Presiona "Comenzar" para iniciar tu sesión de mindfulness';
            
            // Actualizar estadísticas
            updateStats();
            
            // Mensaje inicial
            updateMotivationalMessage();
        }
        
        // Función para iniciar timer de sesión
        function startSessionTimer() {
            sessionTimer = setInterval(() => {
                if (isSessionActive) {
                    sessionTime++;
                    updateStats();
                    
                    // Actualizar mensaje motivacional cada 30 segundos
                    if (sessionTime % 30 === 0) {
                        updateMotivationalMessage();
                    }
                }
            }, 1000);
        }
        
        // Función para ejecutar un ciclo de respiración
        function startBreathingCycle() {
            if (!isSessionActive) return;
            
            console.log('🔄 Iniciando ciclo de respiración');
            
            // Fase 1: Preparación
            currentPhase = 'prepare';
            breathingInstruction.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Prepárate para respirar...';
            
            breathingTimer = setTimeout(() => {
                if (!isSessionActive) return;
                
                // Fase 2: Inhalar
                currentPhase = 'inhale';
                breathingInstruction.innerHTML = '<i class="fas fa-arrow-up"></i> Inhala lentamente... (4 segundos)';
                
                breathingCircle.classList.remove('exhale');
                breathingCircle.classList.add('inhale');
                
                breathingTimer = setTimeout(() => {
                    if (!isSessionActive) return;
                    
                    // Fase 3: Mantener
                    currentPhase = 'hold';
                    breathingInstruction.innerHTML = '<i class="fas fa-pause"></i> Mantén... (2 segundos)';
                    
                    breathingTimer = setTimeout(() => {
                        if (!isSessionActive) return;
                        
                        // Fase 4: Exhalar
                        currentPhase = 'exhale';
                        breathingInstruction.innerHTML = '<i class="fas fa-arrow-down"></i> Exhala despacio... (6 segundos)';
                        
                        breathingCircle.classList.remove('inhale');
                        breathingCircle.classList.add('exhale');
                        
                        breathingTimer = setTimeout(() => {
                            if (!isSessionActive) return;
                            
                            // Completar ciclo
                            breathCount++;
                            mindfulScore += 10;
                            updateStats();
                            
                            // Continuar con el siguiente ciclo
                            startBreathingCycle();
                            
                        }, EXHALE_TIME);
                    }, HOLD_TIME);
                }, INHALE_TIME);
            }, PREPARE_TIME);
        }
        
        // Función para actualizar estadísticas
        function updateStats() {
            if (breathCountElement) {
                breathCountElement.textContent = breathCount;
            }
            if (sessionTimeElement) {
                sessionTimeElement.textContent = formatTime(sessionTime);
            }
            if (mindfulScoreElement) {
                mindfulScoreElement.textContent = mindfulScore;
            }
        }
        
        // Función para formatear tiempo
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Función para actualizar mensaje motivacional
        function updateMotivationalMessage() {
            if (!motivationalMessageElement) return;
            
            const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            motivationalMessageElement.innerHTML = '<i class="fas fa-quote-left"></i> ' + randomMessage + ' <i class="fas fa-quote-right"></i>';
        }
        
        // Función para agregar event listeners
        function addEventListeners() {
            console.log('🔗 Agregando event listeners...');
            
            if (startBtn) {
                startBtn.addEventListener('click', startMindfulness);
                console.log('✅ Listener agregado a startBtn');
            }
            
            if (pauseBtn) {
                pauseBtn.addEventListener('click', pauseMindfulness);
                console.log('✅ Listener agregado a pauseBtn');
            }
            
            if (resetBtn) {
                resetBtn.addEventListener('click', resetMindfulness);
                console.log('✅ Listener agregado a resetBtn');
            }
            
            // Evento de teclado para espacio
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space') {
                    event.preventDefault();
                    if (!isSessionActive) {
                        startMindfulness();
                    } else {
                        pauseMindfulness();
                    }
                }
            });
        }
        
        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📄 DOM cargado, inicializando mindfulness...');
            
            // Inicializar elementos
            initializeElements();
            
            // Verificar que los elementos existen
            if (!startBtn || !pauseBtn || !resetBtn) {
                console.error('❌ Error: No se encontraron todos los botones');
                alert('Error: No se pudieron encontrar los botones. Por favor, recarga la página.');
                return;
            }
            
            // Agregar event listeners
            addEventListeners();
            
            // Inicializar estadísticas y mensaje
            updateStats();
            updateMotivationalMessage();
            
            console.log('✅ Aplicación de mindfulness inicializada correctamente');
            console.log('ℹ️ Puedes usar la barra espaciadora para iniciar/pausar');
        });
        
        // Hacer funciones disponibles globalmente para debugging
        window.mindfulnessApp = {
            start: startMindfulness,
            pause: pauseMindfulness,
            reset: resetMindfulness,
            isActive: () => isSessionActive,
            stats: () => ({ breathCount, sessionTime, mindfulScore })
        };
        
        console.log('✅ Script de mindfulness cargado completamente');
    </script>
</body>
</html>
